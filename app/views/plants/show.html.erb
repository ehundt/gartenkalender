<%= render partial: "sidebar" %>

<div class="row">
  <div class="col-xs-6">
    <% if @plant.user != current_user %>
      <strong>Original&nbsp;</strong>
      <% if @plant.copy_of(current_user) %>
        <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
        gehe zu:
        <%= link_to "meiner Pflanze", @plant.copy_of(current_user) %>
      <% end %>
    <% elsif @plant.user == current_user %>
      <strong>Meine Pflanze</strong>
    <% end %>
  </div>

  <% if @plant.creator != current_user %>
    <%= render partial: "orig_plant_bar", locals: { plant: @plant } %>
  <% end %>
</div>
<div class="row">
  <div class="col-xs-5">
    <h2>
      <% if @plant.user == current_user %>
        <span class="active-button" data-id="<%= @plant.id %>" data-path="">
          <% if @plant.active %>
            <%= image_tag "plant_active.gif", height: '42px', width: '30px',
                 "data-toggle" => "tooltip", "data-placement" => "bottom",
                 title: "Pflanze ist aktiv, d.h. Pflegetipps werden in der Aufgabenliste angezeigt. Zum aktiv schalten, bitte auf das Bild klicken." %>
          <% else %>
            <%= image_tag "plant_inactive.gif", height: '42px', width: '30px', "data-toggle" => "tooltip", "data-placement" => "bottom",
                 title: "Pflanze ist inaktiv, d.h. Pflegetipps werden in der Aufgabenliste nicht angezeigt. Zum aktiv schalten, bitte auf das Bild klicken."  %>
          <% end %>
        </span>
      <% end %>
      <%= @plant.name %>
    </h2>
  </div>
  <div class="col-xs-7 edit-plant-link">
    <% if (can? :clone, @plant) && @plant.user != current_user %>
      <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span>
      <%= link_to 'Kopieren', clone_plant_path(@plant), method: :post %>&nbsp;
    <% end %>

    <% if can? :manage, @plant %>
      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
      <%= link_to 'Pflanze bearbeiten', edit_plant_path(@plant) %>&nbsp;
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-xs-6">
    <h5><%= @plant.subtitle %></h5>
  </div>
  <div class="col-xs-6 show-category">
    <strong>Kategorie: </strong><%= @plant.category.humanize %></h5>
  </div>
</div>

<div class="row">
  <div class="col-xs-12">
    <%= raw markdown.render(@plant.desc) %>
  </div>
</div>

<% unless @plant.tasks.empty? %>
  <div class="row">
    <div class="col-xs-12">
      <h4>Aufgaben</h4>

      <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        <%= render @plant.tasks %>
      </div>

    </div>
  </div>
<% end %>

<% if can? :update, @plant %>
  <% if @plant.tasks.empty? %>
    <h4>Neue Aufgabe</h4>
    <%= render partial: "/tasks/form" %>
  <% else %>
    <div class="row">
      <div class="col-xs-12">
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          <%= link_to "Neue Aufgabe", new_plant_task_path(@plant) %>
      </div>
    </div>
  <% end %>
<% end %>
<br>
<br>

<% if @plant.user == current_user %>
  <% unless @done_tasks.empty? %>
    <h4>Erledigte Aufgaben</h4>
    <table class="table">
      <tr>
        <th>Aufgabe</th>
        <th>Notiz</th>
        <th>Datum</th>
        <th></th>
        <th></th>
      </tr>
      <% @plant.tasks.order(updated_at: :desc).each do |task| %>
        <%= render task.done_tasks %>
      <% end %>
    </table>
  <% end %>
<% end %>
