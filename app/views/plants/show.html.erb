<%= render partial: "sidebar" %>

<div class="row">
  <div class="col-xs-3">
    <h4><%= @plant.name %></h4>
  </div>
  <div class="col-xs-2 active-status">
  </div>
  <div class="col-xs-7 edit-plant-link">
    <% if @plant.user != current_user %>
      <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span>
      <%= link_to 'Kopieren', clone_plant_path(@plant), method: :post %>
    <% end %>

    <% if can? :manage, @plant %>
      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
      <%= link_to 'Pflanze bearbeiten', edit_plant_path(@plant) %>
    <% end %>

    <% if @plant.creator != @plant.user && !@plant.orig_id.nil? %>
      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
      <%= link_to 'Original', plant_path(@plant.orig_id) %>
    <% end %>
  </div>
</div>
<% if @plant.creator != current_user && @plant.user != current_user %>
  <div class="row">
    <div class="col-xs-12">
      <% if @plant.creator.picture.file? %>
        <%= link_to image_tag(@plant.creator.picture.url(:thumb), class: "img-rounded"), @plant.creator %>
      <% end %>
      von <%= @plant.creator.display_name %>
    </div>
  </div>
<% end %>
<p>
  <h4><%= @plant.subtitle %></h4>
</p>
<p>
  <%= raw markdown.render(@plant.desc) %>
</p>

<% unless @plant.tasks.empty? %>
<br />
<h4>Aufgaben</h4>
<table class="table task-list">
  <tr>
    <th>Anzeigen</th>
    <th>Titel</th>
    <th>Status</th>
    <th></th>
  </tr>
  <%= render @plant.tasks %>
</table>
<% end %>

<% if can? :update, @plant %>
  <div class="row">
    <div class="col-xs-12">
      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        <%= link_to "Neue Aufgabe", new_plant_task_path(@plant) %>
    </div>
  </div>
<% end %>
<br>
<br>

<% if @plant.user == current_user %>
  <% unless @done_tasks.empty? %>
    <h4>Erledigte Aufgaben</h4>
    <table class="table">
      <tr>
        <th>Aufgabe</th>
        <th>erledigt am</th>
      </tr>
      <% @plant.tasks.order(updated_at: :desc).each do |task| %>
        <%= render task.done_tasks %>
      <% end %>
    </table>
  <% end %>
<% end %>
