<%= render partial: "plants/sidebar" %>
<%= render partial: "plants/header" %>

<div class="row">
  <div class="col-xs-12 edit-plant-link">
  </div>
</div>

<% if @tasks.empty? %>
  ...noch keine Aufgaben.<br><br>

  <h4>Neue Aufgabe anlegen</h4>
  <%= render partial: "form" %>

<% else %>
  <table class="table">

    <% @tasks.each do |task| %>
      <tr>
        <td>
          <% if task.hide %>
            <div class="task-visibility" data-task-id="<%= task.id %>" data-plant-id="<%= task.plant.id %>" data-path="/plants/">
              <%= image_tag "eye_not_visible.jpg" %>
            </div>
          <% else %>
            <div class="task-visibility" data-task-id="<%= task.id %>" data-plant-id="<%= task.plant.id %>" data-path="/plants/">
            <%= image_tag "eye_visible.jpg" %>
            </div>
          <% end %>
        </td>

        <td>
          <% if !task.task_images.empty? && task.task_images[0].image.file? %>
            <%= image_tag(download_task_image_plant_task_task_image_path(@plant, task, task.task_images[0], {size: :thumb}), class: "img-rounded img-responsive") %>

          <% end %>
        </td>

        <td>
          <%= link_to task.title, plant_task_path(task.plant, task) %>
        </td>
        <td>
          <% if user_signed_in? %>
            <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
            <% if task.done? %>
              ist erledigt
            <% elsif task.skipped? %>
              übersprungen
            <% elsif task.upcoming? %>
              <span class="task-warning">wartet auf Ausführung</span>
            <% else %>
              steht zur Zeit nicht an
            <% end %>
          <% end %>
        </td>
        <td>
          <% if can? :manage, @plant %>
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
              <%= link_to 'Bearbeiten', edit_plant_task_path({ id: task.id, plant_id: task.plant_id }) %>&nbsp;
            <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
            <%= link_to 'Entfernen', [task.plant, task], method: :delete, data: { confirm: 'Sind Sie sicher?' }, class: "delete-link" %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>

  <div class="row">
    <div class="col-xs-12">
      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        <%= link_to "Neue Aufgabe", new_plant_task_path(@plant) %>
    </div>
  </div>

<% end %>
