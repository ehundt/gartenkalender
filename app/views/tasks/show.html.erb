<%= render partial: "sidebar" %>
<%= render partial: "plants/header" %>

<div class="row">
  <div class="col-xs-12 edit-plant-link">
  </div>
</div>

<div class="row">
  <div class="col-xs-6">
    <h4>
      <button type="button" class="btn btn-default eye-button">
        <span class="task-visibility" data-task-id="<%= @task.id %>" data-plant-id="<%= @task.plant.id %>" data-path="/plants/">
          <% if @task.hide %>
              <%= image_tag "eye_not_visible.jpg" %>
          <% else %>
              <%= image_tag "eye_visible.jpg" %>
          <% end %>
        </span>
      </button>
    <%= @task.title %></h4>
  </div>
  <div class="col-xs-6 edit-plant-link">
    <% if can? :manage, @plant %>
      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
      <%= link_to 'bearbeiten', edit_plant_task_path(@plant, @task) %>&nbsp;
      <%= link_to (image_tag "red_cross.jpg", width: "20px", height: "20px"),
            plant_task_path(@task.plant, @task),
            method: :delete,
            data: { confirm: 'Diese Aufgabe löschen?' },
            class: "btn btn-default" %>
    <% end %>

  </div>
</div>

<div class="row">
  <div class="col-xs-12">
    <%= raw markdown.render(@task.desc) %>
  </div>
</div>

<div class="row">

  <% if task_time_frame(@task).present? %>
    <div class="col-xs-12">
      <% if @task.upcoming? %>
          <%= image_tag "exclamation_mark.png", width: "20px", height: "20px" %>
      <% else %>
        <button type="button" class="btn btn-default task-ok" disabled="disabled">
        <%= image_tag "ok.png", width: "20px", height: "20px" %>
        </button>
      <% end %>
      <strong>Zeitraum:</strong>
      <%= task_time_frame(@task) %>
      &nbsp;<%= image_tag "green_flower_icon.png", width: "15px" %>&nbsp;
  <% else %>
    <div class="col-xs-6">
  <% end %>

    <strong>Wiederholung:</strong>
    <%= @task.repeat.humanize %>
    <br><br>
  </div>
</div>

<div class="row">
  <div class="col-xs-6">
    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
      <% if @task.done? %>
        ist erledigt
      <% elsif @task.skipped? %>
        übersprungen
      <% elsif @task.upcoming? %>
        <span class="task-warning">wartet auf Ausführung</span>
      <% else %>
        steht zur Zeit nicht an
      <% end %>
  </div>
  <div class="col-xs-6 task-action-links">
    <% if can? :manage, @task %>
      <button type="button" class="btn btn-default" data-toggle="modal" data-target="#taskDoneModal<%= @task.id %>">
        <%= image_tag "schaufel.png", width: "25px", height: "25px" %>
      </button>
    <% end %>
  </div>
</div>

<%= form_for :done_task,
    url: plant_done_tasks_path(@task.plant, @task) do |f| %>
  <%= render partial: "done_tasks/modal",
               locals: { plant:     @task.plant,
                         task:      @task,
                         modal_id:  @task.id,
                         done_task: nil,
                         f:         f,
                         skipped:   false } %>
<% end %>

<div class="row">
  <div class="col-xs-12 green-flower-separator">
    <%= image_tag "green_flower_icon.png", width: "50px", height: "50px" %>
  </div>
</div>

<% if @task.plant.user == current_user %>
  <% unless @task.done_tasks.empty? %>
    <h4>Tagebuch: <%= @task.title %></h4>
    <table class="table">
      <tr>
        <th>Aufgabe</th>
        <th>Notiz</th>
        <th>Datum</th>
        <th></th>
        <th></th>
      </tr>
        <%= render @task.done_tasks %>
    </table>
  <% end %>
<% end %>
</br>
</br>
</br>
