<div class="panel panel-default">
  <div class="panel-heading" role="tab" id="heading<%= task.id %>">
    <h4 class="panel-title">
      <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapse<%= task.id %>" aria-expanded="false" aria-controls="collapse<%= task.id %>">
        <div class="row">
          <div class="col-xs-6">
            <%= task.title %>
          </div>
          <div class="col-xs-6 task-action-links">
            <% if can? :manage, @plant %>
              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                <%= link_to 'Bearbeiten', edit_plant_task_path({ id: task.id, plant_id: task.plant_id }) %>&nbsp;
              <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
              <%= link_to 'Entfernen', [task.plant, task], method: :delete, data: { confirm: 'Sind Sie sicher?' }, class: "delete-link" %>
            <% end %>
          </div>
        </div>
      </a>
    </h4>
  </div>
  <div id="collapse<%= task.id %>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading<%= task.id %>">
    <div class="panel-body">
      <% if can? :manage, task %>
        <div class="row">
          <div class="col-xs-2">
            <% if task.hide %>
              <div class="task-visibility" data-id="<%= task.id %>" data-plant-id="<%= task.plant.id %>" data-path="">
                <span class="glyphicon glyphicon-eye-close" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Sichtbarkeit in der Aufgabenliste durch Anklicken des Auges an- oder ausschalten."></span>
              </div>
            <% else %>
              <div class="task-visibility" data-id="<%= task.id %>" data-plant-id="<%= task.plant.id %>" data-path="">
                <span class="glyphicon glyphicon-eye-open" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="Sichtbarkeit in der Aufgabenliste durch Anklicken des Auges an- oder ausschalten."></span>
              </div>
            <% end %>&nbsp;
          </div>
          <div class="col-xs-5">
            Wiederholung: <%= task.repeat.humanize %>
          </div>
          <div class="col-xs-5 task-action-links">
            <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
            <% if task.done? %>
              ist erledigt
            <% elsif task.skipped? %>
              übersprungen
            <% elsif task.upcoming? %>
              <span class="task-warning">wartet auf Ausführung</span>
            <% else %>
              steht zur Zeit nicht an
            <% end %>
          </div>
        </div>
        <br>
      <% end %>

      <div class="row">
        <div class="col-xs-12">
          <%= raw markdown.render(task.desc) %>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 task-action-links">
          <% if can? :manage, task %>
            <% unless task.done? %>
              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
              <%= link_to "als erledigt markieren", plant_task_done_tasks_path({task_id: task.id, plant_id: task.plant.id}), method: :post %>&nbsp;
            <% end %>

            <% if task.upcoming? %>
              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
              <%= link_to "überspringen", plant_task_done_tasks_path({task_id: task.id, plant_id: task.plant.id, skipped: true}), method: :post %>&nbsp;
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
