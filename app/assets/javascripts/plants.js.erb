var onPageReady = function(){
  $('.likes-count').on('click', function(){
    var plant_id  = $(this).data("id");
    var likesIcon = $(this).children("img");
    var path      = $(this).data("path");
    var likesText = $(this).children("span");
    var likesInt  = parseInt(likesText.text());

    console.log("likesText = " + likesText + ", likesInt = " + likesInt);

    if ($(likesIcon).attr("src") == "<%= image_url('thumb_up_voted.png') %>")
      $.ajax({
        url:      path + plant_id + "/unvote",
        type:     "POST",
        dataType: "json",
        data:     { plant: { id: plant_id } },
        success:  function(data, status){
          likesText.text(likesInt - 1);
          $(likesIcon).attr("src", "<%= image_url('thumb_up_not_voted.png') %>");
        }
      });

    if ($(likesIcon).attr("src") == "<%= image_url('thumb_up_not_voted.png') %>")
      $.ajax({
        url:      path + plant_id + "/vote",
        type:     "POST",
        dataType: "json",
        data:     { plant: { id: plant_id } },
        success:  function(data, status){
          likesText.text(likesInt + 1);
          $(likesIcon).attr("src", "<%= image_url('thumb_up_voted.png') %>");
        }
      });
  });

  $('.active-button').on('click', function(){
    var plant_id = $(this).data("id");
    var path = $(this).data("path");
    var activeIcon = $(this).children("img");
    if ($(activeIcon).attr("src") == "<%= image_url('plant_active.gif') %>")
      $.ajax({
        url:      path + plant_id + "/inactivate",
        type:     "PATCH",
        dataType: "json",
        data:     { plant: {id: plant_id} },
        success:  function(data, status){
                    $(activeIcon).attr("src", "<%= image_url('plant_inactive.gif') %>");
                  }
      });

    if ($(activeIcon).attr("src") == "<%= image_url('plant_inactive.gif') %>")
      $.ajax({
        url:      path + plant_id + "/activate",
        type:     "PATCH",
        dataType: "json",
        data:     { plant: {id: plant_id} },
        success:  function(data, status){
                    $(activeIcon).attr("src", "<%= image_url('plant_active.gif') %>");
                  }
      });
  });

  $('.plant-visibility').on('click', function(){
    var world_globe = $(this).children("img");
    var privacy_text = $(this).children("span");
    var plant_id = $(this).data("plant-id");
    var switch_allowed = $(this).data("switch-allowed");

    if ($(world_globe).attr("src") == "<%= image_url('world-globe32x32.png') %>"){
      if (switch_allowed == 1)
        $.ajax({
          url: "/plants/" + plant_id,
          type: "PATCH",
          dataType: "json",
          data: { plant: {id: plant_id, public: false} },
          success: function(data, status){
            $(world_globe).attr("src", "<%= image_url('not-world-globe32x32.png') %>");
            privacy_text.text("privat");
          }
        });
    };

    if ($(world_globe).attr("src") == "<%= image_url('not-world-globe32x32.png') %>"){
      if (switch_allowed == 1)
        $.ajax({
          url: "/plants/" + plant_id,
          type: "PATCH",
          dataType: "json",
          data: { plant: {id: plant_id, public: true} },
          success: function(data, status){
            $(world_globe).attr("src", "<%= image_url('world-globe32x32.png') %>");
            privacy_text.text("Ã¶ffentlich");
          }
        });
    };
  });
};

$(document).ready(onPageReady);
$(document).on("page:load", onPageReady);
